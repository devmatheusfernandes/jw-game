{
  "authentication": {
    "provider": "google + anonymous",
    "flow": "Firebase Auth com Google e Anonymous para convidados",
    "rules": [
      "Usuário autenticado (Google) tem acesso completo às features pessoais",
      "Convidados (Anonymous) podem criar/entrar em sessões públicas",
      "Somente admins podem criar conteúdo universal"
    ]
  },

  "collections": {
    "universal": {
      "decks": "decks (criados apenas por admin)",
      "questions": "questions (criados apenas por admin)"
    },
    "userOwned": {
      "userDecks": "users/{userId}/decks",
      "userQuestions": "users/{userId}/questions"
    },
    "gameplay": {
      "gameResults": "gameResults (somente leitura/escrita pelo próprio usuário)",
      "sessions": "sessions com subcoleções users e answers; leitura pública quando opened = true"
    }
  },

  "domain": {
    "description": "Regras de negócio puras e independentes de Next.js/Firebase",
    "entities": {
      "Deck": {
        "id": "string",
        "ownerId": "string | null",
        "title": "string",
        "description": "string",
        "category": "string",
        "questionIds": ["string"],
        "createdAt": "string",
        "isUniversal": "boolean"
      },
      "Question": {
        "id": "string",
        "deckId": "string",
        "ownerId": "string | null",
        "prompt": "string",
        "options": ["string"],
        "answerIndex": "number",
        "difficulty": "easy | medium | hard",
        "isUniversal": "boolean"
      },
      "GameResult": {
        "id": "string",
        "userId": "string",
        "deckId": "string",
        "answers": [
          {
            "questionId": "string",
            "correct": "boolean",
            "timestamp": "string"
          }
        ],
        "score": "number",
        "startedAt": "string",
        "finishedAt": "string"
      }
    }
  },

  "application": {
    "description": "Casos de uso e lógica de orquestração",
    "useCases": {
      "GetUniversalDecks": "Retorna decks criados por administradores",
      "GetUserDecks": "Retorna decks pessoais do usuário",
      "CreateUserDeck": "Cria deck pessoal dentro do escopo do usuário",
      "CreateUserQuestion": "Cria pergunta pessoal",
      "CreateUniversalDeck": "ADMIN – cria deck universal",
      "CreateUniversalQuestion": "ADMIN – cria pergunta universal",
      "StartGame": "Inicia jogo com deck universal ou pessoal",
      "SubmitAnswer": "Registra resposta em memória e no repositório",
      "FinishGame": "Finaliza partida e grava pontuação",
      "GetGameHistory": "Retorna histórico do usuário"
    },
    "services": {
      "GameService": "Controla fluxo de jogo",
      "DeckService": "Opera sobre decks universais e pessoais",
      "QuestionService": "Opera sobre perguntas universais e pessoais",
      "UserService": "Gerencia dados pessoais e estatísticas"
    }
  },

  "infrastructure": {
    "description": "Implementações Firebase que servem ao domínio",
    "repositories": {
      "UniversalDeckRepositoryFirebase": {
        "collection": "decks",
        "adminsOnly": true,
        "methods": [
          "getAll()",
          "getById(id)",
          "create(deck) (ADMIN)",
          "update(deck) (ADMIN)"
        ]
      },
      "UniversalQuestionRepositoryFirebase": {
        "collection": "questions",
        "adminsOnly": true,
        "methods": [
          "getByDeck(deckId)",
          "getById(id)",
          "create(question) (ADMIN)"
        ]
      },
      "UserDeckRepositoryFirebase": {
        "collection": "users/{userId}/decks",
        "methods": [
          "getAll(userId)",
          "getById(userId, deckId)",
          "create(userId, deck)",
          "update(userId, deck)",
          "delete(userId, deckId)"
        ]
      },
      "UserQuestionRepositoryFirebase": {
        "collection": "users/{userId}/questions",
        "methods": [
          "getByDeck(userId, deckId)",
          "getById(userId, questionId)",
          "create(userId, question)"
        ]
      },
      "GameRepositoryFirebase": {
        "methods": [
          "createGame(gameResult)",
          "appendAnswer(gameId, answer)",
          "finishGame(gameId, score)",
          "getHistory(userId)"
        ]
      },
      "SessionRepositoryFirebase": {
        "collection": "sessions",
        "methods": [
          "createSession(session)",
          "updateSession(session)",
          "closeSession(sessionId)",
          "addUser(sessionId, user)",
          "removeUser(sessionId, userId)",
          "addAnswer(sessionId, answer)"
        ]
      }
    },
    "firebase": {
      "auth": "Google + Anonymous",
      "firestore": "Universal + userOwned + gameplay (sessions/gameResults)",
      "adminClaims": "Para permitir escrita em coleções universais"
    }
  },

  "presentation": {
    "description": "Camada Next.js (UI)",
    "pages": {
      "public": [
        "/ (home)",
        "/login",
        "/session/[id]"
      ],
      "userAuthenticated": [
        "/play",
        "/play/[deckId]",
        "/my-decks",
        "/my-decks/[deckId]",
        "/my-questions"
      ],
      "admin": [
        "/admin/decks",
        "/admin/questions"
      ]
    },
    "components": {
      "uiComponents": "shadcn/ui",
      "customComponents": "List DeckCard, QuestionCard, GameScreen, etc",
      "providers": [
        "AuthProvider (Google/Anonymous)",
        "ThemeProvider"
      ]
    }
  },

  "permissions": {
    "roles": {
      "user": "Pode criar decks e perguntas pessoais; ler universais",
      "admin": "Pode criar/editar universais e acessar área administrativa"
    }
  }
}
